#!/bin/bash

LOG_FILE="/var/log/tu-security-toolkit.log"
TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")

log() {
    echo "[$TIMESTAMP] $1" | tee -a "$LOG_FILE"
}

echo "ðŸ” Technology Universe Security Toolkit v0.0.3"
echo "---------------------------------------------"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° root
if [[ $EUID -ne 0 ]]; then
    echo "âŒ This installer must be run as root."
    exit 1
fi

CURRENT_STATUS=$(spctl --status 2>/dev/null)

log "Current Gatekeeper Status: $CURRENT_STATUS"

if [[ "$CURRENT_STATUS" == "assessments disabled" ]]; then
    log "Gatekeeper already disabled. No action required."
    exit 0
fi

log "Attempting to disable Gatekeeper..."

spctl --global-disable
spctl --master-disable 2>/dev/null

NEW_STATUS=$(spctl --status 2>/dev/null)

log "New Gatekeeper Status: $NEW_STATUS"

if [[ "$NEW_STATUS" == "assessments disabled" ]]; then
    log "SUCCESS: Gatekeeper successfully disabled."
    exit 0
else
    log "ERROR: Gatekeeper may still be active."
    exit 2
fi
